---
// Lista de ciudades con sus coordenadas (latitud y longitud)
const ciudadesConCoordenadas = [
  // Ciudades españolas
  { nombre: 'Alicante', lat: 38.3452, lon: -0.481 },
  { nombre: 'Almería', lat: 36.834, lon: -2.4637 },
  { nombre: 'Barcelona', lat: 41.3851, lon: 2.1734 },
  { nombre: 'Bilbao', lat: 43.263, lon: -2.9349 },
  { nombre: 'Castelló de la Plana', lat: 39.9864, lon: -0.0513 },
  { nombre: 'Girona', lat: 41.9818, lon: 2.8249 },
  { nombre: 'Granada', lat: 37.1773, lon: -3.5986 },
  { nombre: 'Las Palmas de Gran Canaria', lat: 28.1235, lon: -15.4363 },
  { nombre: 'Madrid', lat: 40.4168, lon: -3.7038 },
  { nombre: 'Málaga', lat: 36.7213, lon: -4.4214 },
  { nombre: 'Oviedo', lat: 43.3619, lon: -5.8494 },
  { nombre: 'Palma de Mallorca', lat: 39.5696, lon: 2.6502 },
  { nombre: 'Santa Cruz de Tenerife', lat: 28.4636, lon: -16.2518 },
  { nombre: 'Sevilla', lat: 37.3891, lon: -5.9845 },
  { nombre: 'Valencia', lat: 39.4699, lon: -0.3763 },
  { nombre: 'Vitoria', lat: 42.846, lon: -2.6716 },
  { nombre: 'Zaragoza', lat: 41.6488, lon: -0.8891 },
  //Centros financieros globales
  { nombre: 'Nueva York', lat: 40.7128, lon: -74.006 },
  { nombre: 'Londres', lat: 51.5074, lon: -0.1278 },
  { nombre: 'Singapur', lat: 1.3521, lon: 103.8198 },
  { nombre: 'Hong Kong', lat: 22.3193, lon: 114.1694 },
  { nombre: 'San Francisco', lat: 37.7749, lon: -122.4194 },
  { nombre: 'Los Ángeles', lat: 34.0522, lon: -118.2437 },
  { nombre: 'Shanghái', lat: 31.2304, lon: 121.4737 },
  { nombre: 'Chicago', lat: 41.8781, lon: -87.6298 },
  { nombre: 'Boston', lat: 42.3601, lon: -71.0589 },
  { nombre: 'Seúl', lat: 37.5665, lon: 126.978 },
  { nombre: 'Pekín', lat: 39.9042, lon: 116.4074 },
  { nombre: 'Dubái', lat: 25.2048, lon: 55.2708 },
  { nombre: 'Tokio', lat: 35.6895, lon: 139.6917 },
  { nombre: 'Sídney', lat: -33.8688, lon: 151.2093 },
  { nombre: 'París', lat: 48.8566, lon: 2.3522 },
  { nombre: 'Toronto', lat: 43.6511, lon: -79.3832 },
  { nombre: 'Ámsterdam', lat: 52.3676, lon: 4.9041 },
  { nombre: 'Fráncfort', lat: 50.1109, lon: 8.6821 },
  { nombre: 'Zúrich', lat: 47.3769, lon: 8.5417 },
  { nombre: 'Washington D.C.', lat: 38.9072, lon: -77.0369 },
  { nombre: 'Melbourne', lat: -37.8136, lon: 144.9631 },
  { nombre: 'Ginebra', lat: 46.2044, lon: 6.1432 },
  { nombre: 'Luxemburgo', lat: 49.6117, lon: 6.1319 },
  { nombre: 'Múnich', lat: 48.1351, lon: 11.582 },
  { nombre: 'Guangzhou', lat: 23.1291, lon: 113.2644 },
  { nombre: 'Shenzhen', lat: 22.5431, lon: 114.0579 },
  { nombre: 'Abu Dhabi', lat: 24.4539, lon: 54.3773 },
  { nombre: 'Copenhague', lat: 55.6761, lon: 12.5683 },
  { nombre: 'Taipei', lat: 25.033, lon: 121.5654 },
  { nombre: 'Dublín', lat: 53.3498, lon: -6.2603 },
  { nombre: 'Macao', lat: 22.1987, lon: 113.5439 },
  { nombre: 'Estocolmo', lat: 59.3293, lon: 18.0686 },
  { nombre: 'Hamburgo', lat: 53.5511, lon: 9.9937 },
  { nombre: 'Bruselas', lat: 50.8503, lon: 4.3517 },
  { nombre: 'Wellington', lat: -41.2865, lon: 174.7762 },
  { nombre: 'Brisbane', lat: -27.4698, lon: 153.0251 },
  { nombre: 'Oslo', lat: 59.9139, lon: 10.7522 },
  { nombre: 'Viena', lat: 48.2082, lon: 16.3738 },
  { nombre: 'Milán', lat: 45.4642, lon: 9.19 },
  { nombre: 'Varsovia', lat: 52.2297, lon: 21.0122 },
  { nombre: 'Berlín', lat: 52.52, lon: 13.405 },
  { nombre: 'Vancouver', lat: 49.2827, lon: -123.1207 },
  { nombre: 'Ciudad de México', lat: 19.4326, lon: -99.1332 },
  { nombre: 'Doha', lat: 25.276987, lon: 51.521567 },
  { nombre: 'Praga', lat: 50.0755, lon: 14.4378 },
  { nombre: 'Kuala Lumpur', lat: 3.139, lon: 101.6869 },
  { nombre: 'Santiago de Chile', lat: -33.4489, lon: -70.6693 },
  { nombre: 'São Paulo', lat: -23.5505, lon: -46.6333 },
  { nombre: 'Helsinki', lat: 60.1695, lon: 24.9354 },
  { nombre: 'Lisboa', lat: 38.7223, lon: -9.1393 },
  { nombre: 'Buenos Aires', lat: -34.6037, lon: -58.3816 },
  { nombre: 'Riga', lat: 56.9496, lon: 24.1052 },
  { nombre: 'Lima', lat: -12.0464, lon: -77.0428 },
  { nombre: 'Liubliana', lat: 46.0569, lon: 14.5058 },
  { nombre: 'Moscú', lat: 55.7558, lon: 37.6173 },
  { nombre: 'Atenas', lat: 37.9838, lon: 23.7275 },
  { nombre: 'Manama', lat: 26.2235, lon: 50.586 },
  { nombre: 'Monaco', lat: 43.7384, lon: 7.4246 },
  { nombre: 'Riad', lat: 24.7136, lon: 46.6753 },
  { nombre: 'Osaka', lat: 34.6937, lon: 135.5023 },
  { nombre: 'Roma', lat: 41.9028, lon: 12.4964 },
  { nombre: 'Lagos', lat: 6.5244, lon: 3.3792 },
  { nombre: 'Nueva Delhi', lat: 28.6139, lon: 77.209 },
  { nombre: 'Estambul', lat: 41.0082, lon: 28.9784 },
  { nombre: 'Tel Aviv', lat: 32.0853, lon: 34.7818 },
  { nombre: 'Ciudad del Cabo', lat: -33.9249, lon: 18.4241 },
  { nombre: 'Manila', lat: 14.5995, lon: 120.9842 },
  { nombre: 'Tallin', lat: 59.437, lon: 24.7535 },
  { nombre: 'Ho Chi Minh', lat: 10.8231, lon: 106.6297 },
  { nombre: 'Bogotá', lat: 4.711, lon: -74.0721 },
  { nombre: 'Bucarest', lat: 44.4268, lon: 26.1025 },
  { nombre: 'Casablanca', lat: 33.5731, lon: -7.5898 },
  { nombre: 'El Cairo', lat: 30.0444, lon: 31.2357 },
  { nombre: 'Hanoi', lat: 21.0285, lon: 105.8542 },
  { nombre: 'Mumbai', lat: 19.076, lon: 72.8777 },
  { nombre: 'Amán', lat: 31.9539, lon: 35.9106 },
  { nombre: 'Nairobi', lat: -1.2921, lon: 36.8219 },
  { nombre: 'Daca', lat: 23.8103, lon: 90.4125 },
  { nombre: 'Reikiavik', lat: 64.1355, lon: -21.8954 },
  { nombre: 'San Petersburgo', lat: 59.9311, lon: 30.3609 },
  { nombre: 'Kuwait', lat: 29.3759, lon: 47.9774 },
  { nombre: 'Johannesburgo', lat: -26.2041, lon: 28.0473 },
  { nombre: 'Wuhan', lat: 30.5928, lon: 114.3055 },
]

// Ordenar el array alfabéticamente por el nombre de la ciudad
ciudadesConCoordenadas.sort((a, b) => a.nombre.localeCompare(b.nombre))

// Generar las latitudes y longitudes para la llamada a la API
const latitudes = ciudadesConCoordenadas.map((ciudad) => ciudad.lat).join(',')
const longitudes = ciudadesConCoordenadas.map((ciudad) => ciudad.lon).join(',')

const response = await fetch(
  `https://api.open-meteo.com/v1/forecast?latitude=${latitudes}&longitude=${longitudes}&current=temperature_2m,weather_code`
)
const data = await response.json()

// Asociar los nombres de las ciudades con sus respectivas temperaturas
const ciudades = data.map((ciudad, index) => ({
  nombre: ciudadesConCoordenadas[index].nombre,
  temperatura: Math.round(ciudad.current.temperature_2m),
  weather_code: ciudad.current.weather_code,
}))

// Mapeo de códigos de tiempo a iconos
const weatherIcons = {
  0: 'sun.svg', // Despejado
  1: 'partly-cloudy.svg', // Mayormente despejado
  2: 'mostly-cloudy.svg', // Parcialmente nublado
  3: 'cloudy.svg', // Nublado
  45: 'haze.svg', // Niebla
  46: 'snowflake.svg', // Niebla con escarcha
  47: 'winter-warning.svg', // Niebla intensa con escarcha
  48: 'fog.svg', // Niebla intensa
  51: 'rain--drizzle.svg', // Llovizna ligera
  53: 'rain--drizzle.svg', // Llovizna moderada
  55: 'rain--heavy.svg', // Llovizna intensa
  56: 'sleet.svg', // Llovizna congelante ligera
  57: 'wintry-mix.svg', // Llovizna congelante intensa
  61: 'rain--scattered.svg', // Lluvia ligera y esporádica
  63: 'rain--drizzle.svg', // Lluvia esporádica moderada
  65: 'rain--heavy.svg', // Lluvia esporádica intensa
  66: 'sleet.svg', // Lluvia congelante ligera
  67: 'wintry-mix.svg', // Lluvia congelante intensa
  71: 'snow.svg', // Nieve ligera
  73: 'snow--heavy.svg', // Nieve moderada
  75: 'snow--blizzard.svg', // Nieve intensa
  77: 'wintry-mix.svg', // Granizo
  80: 'rain--drizzle.svg', // Chubascos ligeros
  81: 'rain.svg', // Chubascos moderados
  82: 'rain--heavy.svg', // Chubascos intensos
  85: 'sleet.svg', // Chubascos de nieve ligeros
  86: 'wintry-mix.svg', // Chubascos de nieve intensos
  95: 'thunderstorm.svg', // Tormenta eléctrica
  96: 'hail.svg', // Tormenta eléctrica con granizo
  99: 'thunderstorm--severe.svg', // Tormenta eléctrica severa
}
---

<div class="marquee--wrapper">
  <div class="marquee--text">
    <ul class="marquee--text-track">
      {
        ciudades.map((ciudad) => (
          <li>
            {ciudad.nombre}{' '}
            <img
              src={`../icons/${weatherIcons[ciudad.weather_code]}`}
              alt=""
              width="20"
              height="20"
            />{' '}
            {ciudad.temperatura}ºC
          </li>
        ))
      }
      {
        ciudades.map((ciudad) => (
          <li>
            {ciudad.nombre}{' '}
            <img
              src={`../icons/${weatherIcons[ciudad.weather_code]}`}
              alt=""
              width="20"
              height="20"
            />{' '}
            {ciudad.temperatura}ºC
          </li>
        ))
      }
    </ul>
  </div>
</div>

<style>
  .marquee--wrapper {
    padding: 0.625rem 0;
    background-color: #000;
  }
  .marquee--text {
    overflow: clip;
  }
  .marquee--text-track {
    display: flex;
    gap: 1.5rem;
    animation: marquee-move-text 300s linear infinite;
    list-style: none;
    width: max-content;
    padding-left: 1rem;
  }
  .marquee--text-track li {
    display: flex;
    width: max-content;
    gap: 0.5rem;
  }

  .marquee--text-track li img {
    filter: invert(1);
  }

  @keyframes marquee-move-text {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }
</style>
